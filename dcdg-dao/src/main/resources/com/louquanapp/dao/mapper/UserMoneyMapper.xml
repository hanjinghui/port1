<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.louquanapp.dao.mapper.UserMoneyMapper">
  <resultMap id="BaseResultMap" type="com.louquanapp.dao.model.UserMoney">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 04 20:37:33 CST 2019.
    -->
    <id column="MONEY_ID" jdbcType="CHAR" property="moneyId" />
    <result column="USER_ID" jdbcType="CHAR" property="userId" />
    <result column="SHOP_ID" jdbcType="CHAR" property="shopId" />
    <result column="CUST_ID" jdbcType="CHAR" property="custId" />
    <result column="ORDER_ID" jdbcType="CHAR" property="orderId" />
    <result column="ACCOUNT_ID" jdbcType="CHAR" property="accountId" />
    <result column="SOURCE_TYPE" jdbcType="TINYINT" property="sourceType" />
    <result column="MONEY_VALUE" jdbcType="DOUBLE" property="moneyValue" />
    <result column="MONEY_DESC" jdbcType="VARCHAR" property="moneyDesc" />
    <result column="ADD_OR_SUB_TYPE" jdbcType="TINYINT" property="addOrSubType" />
    <result column="LOGIN_USER_ID" jdbcType="CHAR" property="loginUserId" />
    <result column="LOGIN_USER_NAME" jdbcType="VARCHAR" property="loginUserName" />
    <result column="VALUE_TYPE" jdbcType="TINYINT" property="valueType" />
    <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime" />
    <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="CASH_OUT_CONSUME_VALUE" jdbcType="DOUBLE" property="cashOutConsumeValue" />
    <result column="CASH_OUT_POINT_PERCENTAGE" jdbcType="DOUBLE" property="cashOutPointPercentage" />
    <result column="CASH_OUT_BALANCE_PERCENTAGE" jdbcType="DOUBLE" property="cashOutBalancePercentage" />
    <result column="RETURN_ID" jdbcType="CHAR" property="returnId" />
  </resultMap>
  <resultMap id="ExtraBase" type="com.louquanapp.dao.model.UserMoney" extends="BaseResultMap">
    <result column="NICK_NAME" jdbcType="VARCHAR" property="nickName" />
    <result column="HEAD_IMG"  jdbcType="VARCHAR" property="headImg" />
    <result column="custCount"  jdbcType="INTEGER" property="custCount" />

  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 04 20:37:33 CST 2019.
    -->
    delete from andji_system_user_money
    where MONEY_ID = #{moneyId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.louquanapp.dao.model.UserMoney">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 04 20:37:33 CST 2019.
    -->
    insert into andji_system_user_money (MONEY_ID, USER_ID, SHOP_ID, 
      CUST_ID, ORDER_ID, ACCOUNT_ID, 
      SOURCE_TYPE, MONEY_VALUE, MONEY_DESC, 
      ADD_OR_SUB_TYPE, LOGIN_USER_ID, LOGIN_USER_NAME, 
      VALUE_TYPE, ADD_TIME, UPDATE_TIME, 
      CASH_OUT_CONSUME_VALUE, CASH_OUT_POINT_PERCENTAGE, 
      CASH_OUT_BALANCE_PERCENTAGE, RETURN_ID)
    values (#{moneyId,jdbcType=CHAR}, #{userId,jdbcType=CHAR}, #{shopId,jdbcType=CHAR}, 
      #{custId,jdbcType=CHAR}, #{orderId,jdbcType=CHAR}, #{accountId,jdbcType=CHAR}, 
      #{sourceType,jdbcType=TINYINT}, #{moneyValue,jdbcType=DOUBLE}, #{moneyDesc,jdbcType=VARCHAR}, 
      #{addOrSubType,jdbcType=TINYINT}, #{loginUserId,jdbcType=CHAR}, #{loginUserName,jdbcType=VARCHAR}, 
      #{valueType,jdbcType=TINYINT}, #{addTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{cashOutConsumeValue,jdbcType=DOUBLE}, #{cashOutPointPercentage,jdbcType=DOUBLE}, 
      #{cashOutBalancePercentage,jdbcType=DOUBLE}, #{returnId,jdbcType=CHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.louquanapp.dao.model.UserMoney">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 04 20:37:33 CST 2019.
    -->
    update andji_system_user_money
    set USER_ID = #{userId,jdbcType=CHAR},
      SHOP_ID = #{shopId,jdbcType=CHAR},
      CUST_ID = #{custId,jdbcType=CHAR},
      ORDER_ID = #{orderId,jdbcType=CHAR},
      ACCOUNT_ID = #{accountId,jdbcType=CHAR},
      SOURCE_TYPE = #{sourceType,jdbcType=TINYINT},
      MONEY_VALUE = #{moneyValue,jdbcType=DOUBLE},
      MONEY_DESC = #{moneyDesc,jdbcType=VARCHAR},
      ADD_OR_SUB_TYPE = #{addOrSubType,jdbcType=TINYINT},
      LOGIN_USER_ID = #{loginUserId,jdbcType=CHAR},
      LOGIN_USER_NAME = #{loginUserName,jdbcType=VARCHAR},
      VALUE_TYPE = #{valueType,jdbcType=TINYINT},
      ADD_TIME = #{addTime,jdbcType=TIMESTAMP},
      UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      CASH_OUT_CONSUME_VALUE = #{cashOutConsumeValue,jdbcType=DOUBLE},
      CASH_OUT_POINT_PERCENTAGE = #{cashOutPointPercentage,jdbcType=DOUBLE},
      CASH_OUT_BALANCE_PERCENTAGE = #{cashOutBalancePercentage,jdbcType=DOUBLE},
      RETURN_ID = #{returnId,jdbcType=CHAR}
    where MONEY_ID = #{moneyId,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 04 20:37:33 CST 2019.
    -->
    select MONEY_ID, USER_ID, SHOP_ID, CUST_ID, ORDER_ID, ACCOUNT_ID, SOURCE_TYPE, MONEY_VALUE, 
    MONEY_DESC, ADD_OR_SUB_TYPE, LOGIN_USER_ID, LOGIN_USER_NAME, VALUE_TYPE, ADD_TIME, 
    UPDATE_TIME, CASH_OUT_CONSUME_VALUE, CASH_OUT_POINT_PERCENTAGE, CASH_OUT_BALANCE_PERCENTAGE, 
    RETURN_ID
    from andji_system_user_money
    where MONEY_ID = #{moneyId,jdbcType=CHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 04 20:37:33 CST 2019.
    -->
    select MONEY_ID, USER_ID, SHOP_ID, CUST_ID, ORDER_ID, ACCOUNT_ID, SOURCE_TYPE, MONEY_VALUE, 
    MONEY_DESC, ADD_OR_SUB_TYPE, LOGIN_USER_ID, LOGIN_USER_NAME, VALUE_TYPE, ADD_TIME, 
    UPDATE_TIME, CASH_OUT_CONSUME_VALUE, CASH_OUT_POINT_PERCENTAGE, CASH_OUT_BALANCE_PERCENTAGE, 
    RETURN_ID
    from andji_system_user_money
  </select>

  <!--钱包列表-->
  <select id="walletList" resultMap="BaseResultMap">
			select 	MONEY_ID,ORDER_ID,ADD_TIME,CASH_OUT_CONSUME_VALUE,ADD_OR_SUB_TYPE,VALUE_TYPE,SOURCE_TYPE
	         from 	andji_system_user_money
	         where      USER_ID = #{userId,jdbcType=CHAR}
	           <if test="valueType !=null and valueType !=3 ">
	               and  VALUE_TYPE = #{valueType,jdbcType=TINYINT}
               </if>
              <if test="addOrSubType !=null and addOrSubType !=3 ">
                and ADD_OR_SUB_TYPE = #{addOrSubType,jdbcType=TINYINT}
              </if>



  </select>

  <!--按月查询推广返利列表-->
  <select id="queryUserRebateListByAddTime"  resultMap="ExtraBase">

    select a.MONEY_ID,a.CUST_ID,a.CASH_OUT_CONSUME_VALUE,b.NICK_NAME,b.HEAD_IMG
    from andji_system_user_money a  left join dcdg_bussiness_customer_base b on
        a.CUST_ID = b.CUST_ID
    where a.USER_ID = #{userId,jdbcType=CHAR}  and a.SOURCE_TYPE =4
        <if test="beginTime !=null and beginTime!='' ">
           and a.ADD_TIME &gt;= #{beginTime}
        </if>
      <if test="endTime !=null and endTime!='' ">
           and a.ADD_TIME &lt;= #{endTime}
      </if>
  </select>

  <select id="queryEarliestMonthByUserId" resultType="java.util.Date">
    select min(ADD_TIME) from andji_system_user_money where USER_ID = #{userId,jdbcType=CHAR}  and SOURCE_TYPE =4

  </select>


  <!--根据userId查询总的推广返利-->
  <select id="queryTotalUserRebateByUserId"  resultMap="ExtraBase">
    select
        ifnull((
        select sum(CASH_OUT_CONSUME_VALUE) CASH_OUT_CONSUME_VALUE   from andji_system_user_money
        where USER_ID = #{userId,jdbcType=CHAR}  and SOURCE_TYPE =4
          <if test="beginTime !=null and beginTime!='' ">
            and ADD_TIME &gt;= #{beginTime}
          </if>
          <if test="endTime !=null and endTime!='' ">
            and ADD_TIME &lt;= #{endTime}
          </if>
       ),0) as CASH_OUT_CONSUME_VALUE
        ,(
        select count(1) from (
            select CUST_ID   from andji_system_user_money
            where USER_ID = #{userId,jdbcType=CHAR}  and SOURCE_TYPE =4
            <if test="beginTime !=null and beginTime!='' ">
              and ADD_TIME &gt;= #{beginTime}
            </if>
            <if test="endTime !=null and endTime!='' ">
              and ADD_TIME &lt;= #{endTime}
            </if>
            GROUP BY CUST_ID
        ) b

    ) as custCount


  </select>


  <select id="queryMoneyIdBySourceType" resultType="String">
    select MONEY_ID from andji_system_user_money where USER_ID = #{userId,jdbcType=CHAR}  and  SOURCE_TYPE = 6
  </select>









</mapper>