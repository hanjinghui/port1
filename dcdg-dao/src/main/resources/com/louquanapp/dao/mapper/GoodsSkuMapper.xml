<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.louquanapp.dao.mapper.GoodsSkuMapper">
  <resultMap id="BaseResultMap" type="com.louquanapp.dao.model.GoodsSku">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 18 11:20:37 CST 2019.
    -->
    <id column="SKU_ID" jdbcType="CHAR" property="skuId" />
    <result column="GOODS_ID" jdbcType="CHAR" property="goodsId" />
    <result column="SKU_RULE" jdbcType="VARCHAR" property="skuRule" />
    <result column="MAIN_SPEC" jdbcType="CHAR" property="mainSpec" />
    <result column="MAIN_SPEC_OPT" jdbcType="CHAR" property="mainSpecOpt" />
    <result column="VICE_SPEC" jdbcType="CHAR" property="viceSpec" />
    <result column="VICE_SPEC_OPT" jdbcType="CHAR" property="viceSpecOpt" />
    <result column="STOCK_COUNT" jdbcType="INTEGER" property="stockCount" />
    <result column="SUPPLIER_PRICE" jdbcType="DOUBLE" property="supplierPrice" />
    <result column="MARKET_PRICE" jdbcType="DOUBLE" property="marketPrice" />
    <result column="PUTAWAY_PRICE" jdbcType="DOUBLE" property="putawayPrice" />
    <result column="MAX_POINT" jdbcType="DOUBLE" property="maxPoint" />
    <result column="MERCHANT_CODE" jdbcType="VARCHAR" property="merchantCode" />
    <result column="GOODS_CODE" jdbcType="VARCHAR" property="goodsCode" />
    <result column="GOODS_IMG" jdbcType="VARCHAR" property="goodsImg" />
    <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime" />
    <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="SKU_GOODS_NAME" jdbcType="VARCHAR" property="skuGoodsName" />
    <result column="IS_POINT" jdbcType="TINYINT" property="isPoint" />
    <result column="GOODS_TYPE" jdbcType="TINYINT" property="goodsType" />
    <result column="LABEL" jdbcType="VARCHAR" property="label" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 18 11:20:37 CST 2019.
    -->
    delete from dcdg_goods_goods_sku
    where SKU_ID = #{skuId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.louquanapp.dao.model.GoodsSku">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 18 11:20:37 CST 2019.
    -->
    insert into dcdg_goods_goods_sku (SKU_ID, GOODS_ID, SKU_RULE, 
      MAIN_SPEC, MAIN_SPEC_OPT, VICE_SPEC, 
      VICE_SPEC_OPT, STOCK_COUNT, SUPPLIER_PRICE, 
      MARKET_PRICE, PUTAWAY_PRICE, MAX_POINT, 
      MERCHANT_CODE, GOODS_CODE, GOODS_IMG, 
      ADD_TIME, UPDATE_TIME, SKU_GOODS_NAME, 
      IS_POINT, GOODS_TYPE, LABEL
      )
    values (#{skuId,jdbcType=CHAR}, #{goodsId,jdbcType=CHAR}, #{skuRule,jdbcType=VARCHAR}, 
      #{mainSpec,jdbcType=CHAR}, #{mainSpecOpt,jdbcType=CHAR}, #{viceSpec,jdbcType=CHAR}, 
      #{viceSpecOpt,jdbcType=CHAR}, #{stockCount,jdbcType=INTEGER}, #{supplierPrice,jdbcType=DOUBLE}, 
      #{marketPrice,jdbcType=DOUBLE}, #{putawayPrice,jdbcType=DOUBLE}, #{maxPoint,jdbcType=DOUBLE}, 
      #{merchantCode,jdbcType=VARCHAR}, #{goodsCode,jdbcType=VARCHAR}, #{goodsImg,jdbcType=VARCHAR}, 
      #{addTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, #{skuGoodsName,jdbcType=VARCHAR}, 
      #{isPoint,jdbcType=TINYINT}, #{goodsType,jdbcType=TINYINT}, #{label,jdbcType=VARCHAR}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.louquanapp.dao.model.GoodsSku">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 18 11:20:37 CST 2019.
    -->
    update dcdg_goods_goods_sku
    set GOODS_ID = #{goodsId,jdbcType=CHAR},
      SKU_RULE = #{skuRule,jdbcType=VARCHAR},
      MAIN_SPEC = #{mainSpec,jdbcType=CHAR},
      MAIN_SPEC_OPT = #{mainSpecOpt,jdbcType=CHAR},
      VICE_SPEC = #{viceSpec,jdbcType=CHAR},
      VICE_SPEC_OPT = #{viceSpecOpt,jdbcType=CHAR},
      STOCK_COUNT = #{stockCount,jdbcType=INTEGER},
      SUPPLIER_PRICE = #{supplierPrice,jdbcType=DOUBLE},
      MARKET_PRICE = #{marketPrice,jdbcType=DOUBLE},
      PUTAWAY_PRICE = #{putawayPrice,jdbcType=DOUBLE},
      MAX_POINT = #{maxPoint,jdbcType=DOUBLE},
      MERCHANT_CODE = #{merchantCode,jdbcType=VARCHAR},
      GOODS_CODE = #{goodsCode,jdbcType=VARCHAR},
      GOODS_IMG = #{goodsImg,jdbcType=VARCHAR},
      ADD_TIME = #{addTime,jdbcType=TIMESTAMP},
      UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      SKU_GOODS_NAME = #{skuGoodsName,jdbcType=VARCHAR},
      IS_POINT = #{isPoint,jdbcType=TINYINT},
      GOODS_TYPE = #{goodsType,jdbcType=TINYINT},
      LABEL = #{label,jdbcType=VARCHAR}
    where SKU_ID = #{skuId,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 18 11:20:37 CST 2019.
    -->
    select SKU_ID, GOODS_ID, SKU_RULE, MAIN_SPEC, MAIN_SPEC_OPT, VICE_SPEC, VICE_SPEC_OPT, 
    STOCK_COUNT, SUPPLIER_PRICE, MARKET_PRICE, PUTAWAY_PRICE, MAX_POINT, MERCHANT_CODE, 
    GOODS_CODE, GOODS_IMG, ADD_TIME, UPDATE_TIME, SKU_GOODS_NAME, IS_POINT, GOODS_TYPE, 
    LABEL
    from dcdg_goods_goods_sku
    where SKU_ID = #{skuId,jdbcType=CHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 18 11:20:37 CST 2019.
    -->
    select SKU_ID, GOODS_ID, SKU_RULE, MAIN_SPEC, MAIN_SPEC_OPT, VICE_SPEC, VICE_SPEC_OPT, 
    STOCK_COUNT, SUPPLIER_PRICE, MARKET_PRICE, PUTAWAY_PRICE, MAX_POINT, MERCHANT_CODE, 
    GOODS_CODE, GOODS_IMG, ADD_TIME, UPDATE_TIME, SKU_GOODS_NAME, IS_POINT, GOODS_TYPE, 
    LABEL
    from dcdg_goods_goods_sku
  </select>

    <select id="getGoodsSkuByGoodsId" parameterType="java.lang.String" resultMap="BaseResultMap">

        select      SKU_ID, GOODS_ID, SKU_RULE, MAIN_SPEC, MAIN_SPEC_OPT, VICE_SPEC, VICE_SPEC_OPT,
                    STOCK_COUNT, SUPPLIER_PRICE, MARKET_PRICE, PUTAWAY_PRICE, MAX_POINT, MERCHANT_CODE,
                    GOODS_CODE, GOODS_IMG, ADD_TIME, UPDATE_TIME, SKU_GOODS_NAME, IS_POINT, GOODS_TYPE,
                    LABEL

        from dcdg_goods_goods_sku
        where GOODS_ID = #{goodsId,jdbcType=CHAR}
    </select>

    <select id="getGoodsSkuShortByGoodsId" parameterType="java.lang.String" resultMap="BaseResultMap">
        select SKU_ID, SKU_RULE,MARKET_PRICE, PUTAWAY_PRICE, GOODS_IMG,SKU_GOODS_NAME,SUPPLIER_PRICE,IS_POINT
        from dcdg_goods_goods_sku
        where GOODS_ID = #{goodsId,jdbcType=CHAR} limit 1
    </select>

    <select id="getDefaultSkuIdByGoodsId" parameterType="java.lang.String" resultType="String">
        select SKU_ID
        from dcdg_goods_goods_sku
        where GOODS_ID = #{goodsId,jdbcType=CHAR} limit 1
    </select>

    <select id="getSkuIdByReqGoodsSku" resultType="java.lang.String">
        select SKU_ID
        from dcdg_goods_goods_sku
        <where>
            <if test="mainSpec != null and mainSpec !=''">
                AND MAIN_SPEC=#{mainSpec,jdbcType=CHAR}
            </if>
            <if test="mainSpecOpt != null and mainSpecOpt !=''">
                AND MAIN_SPEC_OPT=#{mainSpecOpt,jdbcType=CHAR}
            </if>
            <if test="viceSpec != null and viceSpec !=''">
                AND VICE_SPEC=#{viceSpec,jdbcType=CHAR}
            </if>
            <if test="viceSpecOpt != null and viceSpecOpt !=''">
                AND VICE_SPEC_OPT=#{viceSpecOpt,jdbcType=CHAR}
            </if>
        </where>

    </select>

    <select id="getGoodsNumBySkuId" parameterType="java.lang.String" resultType="int">
        select
       STOCK_COUNT
        from dcdg_goods_goods_sku
        where SKU_ID = #{skuId,jdbcType=CHAR}
    </select>


    <select id="selectGoodsImgAndSkuGoodsNameAndPutawayPriceAndGoodsNumByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
       select
       SKU_ID,STOCK_COUNT,PUTAWAY_PRICE, MAX_POINT, GOODS_IMG, SKU_GOODS_NAME,STOCK_COUNT,MARKET_PRICE,IS_POINT
        from dcdg_goods_goods_sku
        where SKU_ID = #{skuId,jdbcType=CHAR}
    </select>

    <select id="getGoodsNumIdGoodsIdBySkuId" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
       STOCK_COUNT,GOODS_ID,IS_POINT
        from dcdg_goods_goods_sku
        where SKU_ID = #{skuId,jdbcType=CHAR}
    </select>


    <update id="updateStockCountBySkuIdAndGoodsNum">
        update dcdg_goods_goods_sku
        SET STOCK_COUNT =STOCK_COUNT-#{goodsNum,jdbcType=INTEGER},
        UPDATE_TIME = now()
        where SKU_ID = #{skuId,jdbcType=CHAR} AND STOCK_COUNT &gt;= #{goodsNum,jdbcType=INTEGER}
    </update>

    <update id="updateStockCountBySkuIdAndGoodsNumAdd">
        update dcdg_goods_goods_sku
        SET STOCK_COUNT =STOCK_COUNT+#{goodsNum,jdbcType=INTEGER},
        UPDATE_TIME = now()
        where SKU_ID = #{skuId,jdbcType=CHAR}
    </update>

    <update id="minusStockCountByGoodsId" parameterType="java.util.Map">
        update CXY_GOODS_GOODS_BASE set STOCK_COUNT=STOCK_COUNT-#{stockCount,jdbcType=INTEGER},SALE_COUNT =SALE_COUNT+ #{stockCount,jdbcType=INTEGER}  where GOODS_ID = #{goodsId,jdbcType=CHAR}
        AND STOCK_COUNT&gt;=#{stockCount,jdbcType=INTEGER}
    </update>


    <select id="getMinGoodsSkuIdByGoodsId" parameterType="java.lang.String" resultMap="BaseResultMap">

        select SKU_ID,STOCK_COUNT,PUTAWAY_PRICE, MAX_POINT, GOODS_IMG, SKU_GOODS_NAME,STOCK_COUNT,SKU_RULE ,IS_POINT from dcdg_goods_goods_sku
        where GOODS_ID = #{goodsId,jdbcType=CHAR} ORDER BY PUTAWAY_PRICE limit 1
    </select>

    <select id="getGoodsIdsByOptId" parameterType="java.util.List" resultType="String">
        select GOODS_ID from dcdg_goods_goods_sku
        <if test="list != null and list.size()&gt;0">
            where MAIN_SPEC_OPT in
            <foreach close=")" collection="list" item="id" open="(" separator=",">#{id}
            </foreach>
            or VICE_SPEC_OPT in
            <foreach close=")" collection="list" item="id" open="(" separator=",">#{id}
            </foreach>
        </if>
    </select>

    <select id="selectMaxPointPrimaryKey" resultType="Double">
        select MAX_POINT  from dcdg_goods_goods_sku where SKU_ID = #{skuId,jdbcType=CHAR}

    </select>
    <select id="selectMarketPricePrimaryKey" resultType="Double">
        select MARKET_PRICE  from dcdg_goods_goods_sku where SKU_ID = #{skuId,jdbcType=CHAR}

    </select>

    <select id="selectMaxPointByGoodId" resultType="Double">
        select min(MAX_POINT)  from dcdg_goods_goods_sku where GOODS_ID = #{goodsId,jdbcType=CHAR} and  MAX_POINT&gt;0

    </select>


    <!--查询是否允许积分购买-->
    <select id="isPointBySkuNo" resultType="Integer">
        select count(SKU_ID) from dcdg_goods_goods_sku  where  IS_POINT=2 and  SKU_ID = #{skuNo,jdbcType=CHAR}
    </select>

    <!--批量查询是否允许积分购买-->
    <select id="isPointBySkuNos" resultType="Integer">
        select count(SKU_ID) from dcdg_goods_goods_sku  where IS_POINT=2 and SKU_ID in
        <foreach close=")" collection="skuNos" item="id" open="(" separator=",">#{id}
        </foreach>
    </select>

    <!--查询商品sku 是否允许积分兑换的状态-->
    <select id="isPointByGoodsId" resultType="Byte">
        select IS_POINT from dcdg_goods_goods_sku  where  GOODS_ID = #{goodsId,jdbcType=CHAR}
    </select>

    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO dcdg_goods_goods_sku
        (SKU_ID,GOODS_ID,SKU_RULE,MAIN_SPEC,MAIN_SPEC_OPT,VICE_SPEC,VICE_SPEC_OPT,STOCK_COUNT,SUPPLIER_PRICE,MARKET_PRICE,PUTAWAY_PRICE,MAX_POINT,MERCHANT_CODE,GOODS_CODE,GOODS_IMG,ADD_TIME,UPDATE_TIME,SKU_GOODS_NAME,IS_POINT,GOODS_TYPE)
        VALUES
        <foreach collection="list" item="item" index="index"
                 separator=",">
            (#{item.skuId,jdbcType=CHAR},#{item.goodsId,jdbcType=CHAR},#{item.skuRule,jdbcType=VARCHAR},#{item.mainSpec,jdbcType=CHAR},
            #{item.mainSpecOpt,jdbcType=CHAR},#{item.viceSpec,jdbcType=CHAR},#{item.viceSpecOpt,jdbcType=CHAR},#{item.stockCount,jdbcType=INTEGER}
            ,#{item.supplierPrice,jdbcType=DOUBLE},#{item.marketPrice,jdbcType=DOUBLE},#{item.putawayPrice,jdbcType=DOUBLE},#{item.maxPoint,jdbcType=DOUBLE}
            ,#{item.merchantCode,jdbcType=VARCHAR},#{item.goodsCode,jdbcType=VARCHAR},#{item.goodsImg,jdbcType=VARCHAR},#{item.addTime,jdbcType=TIMESTAMP}
            ,#{item.updateTime,jdbcType=TIMESTAMP},#{item.skuGoodsName,jdbcType=VARCHAR},#{item.isPoint,jdbcType=TINYINT},#{item.goodsType,jdbcType=TINYINT})
        </foreach>
    </insert>



    <update id="updateGoodsSku" >
            UPDATE dcdg_goods_goods_sku
            <set>
                STOCK_COUNT = #{stockCount,jdbcType=INTEGER},
                SUPPLIER_PRICE = #{supplierPrice,jdbcType=DOUBLE},
                MARKET_PRICE = #{marketPrice,jdbcType=DOUBLE},
                PUTAWAY_PRICE = #{putawayPrice,jdbcType=DOUBLE},
                GOODS_TYPE = #{goodsType,jdbcType=TINYINT},
                MAX_POINT = #{maxPoint,jdbcType=DOUBLE},
                IS_POINT = #{isPoint,jdbcType=TINYINT},
                SKU_GOODS_NAME = #{skuGoodsName,jdbcType=VARCHAR},
                UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
            </set>
            <where>
                SKU_ID = #{skuId,jdbcType=CHAR}
            </where>
    </update>

</mapper>