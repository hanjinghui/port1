<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.louquanapp.dao.mapper.VideoMapper">
  <resultMap id="BaseResultMap" type="com.louquanapp.dao.model.Video">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 15 13:07:07 CST 2019.
    -->
    <id column="VIDEO_ID" jdbcType="CHAR" property="videoId" />
    <result column="VIDEO_TITLE" jdbcType="VARCHAR" property="videoTitle" />
    <result column="CAT_ID" jdbcType="CHAR" property="catId" />
    <result column="VIDEO_IMG" jdbcType="VARCHAR" property="videoImg" />
    <result column="VIDEO_URL" jdbcType="VARCHAR" property="videoUrl" />
    <result column="VIDEO_PUSH_URL" jdbcType="VARCHAR" property="videoPushUrl" />
    <result column="VIDEO_TIME" jdbcType="INTEGER" property="videoTime" />
    <result column="ONLINE_COUNT" jdbcType="INTEGER" property="onlineCount" />
    <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime" />
    <result column="ADD_USER" jdbcType="CHAR" property="addUser" />
    <result column="ADD_USER_NAME" jdbcType="VARCHAR" property="addUserName" />
    <result column="VIDEO_STATUS" jdbcType="TINYINT" property="videoStatus" />
    <result column="VIDEO_NO" jdbcType="INTEGER" property="videoNo" />
    <result column="CUST_ID" jdbcType="CHAR" property="custId" />
    <result column="VIDEO_START_TIME" jdbcType="TIMESTAMP" property="videoStartTime" />
    <result column="VIDEO_END_TIME" jdbcType="TIMESTAMP" property="videoEndTime" />
    <result column="REAL_START_TIME" jdbcType="TIMESTAMP" property="realStartTime" />
    <result column="REAL_END_TIME" jdbcType="TIMESTAMP" property="realEndTime" />
    <result column="LOCATION" jdbcType="VARCHAR" property="location" />
    <result column="IS_REC" jdbcType="TINYINT" property="isRec" />
    <result column="VIDEO_TYPE" jdbcType="TINYINT" property="videoType" />
    <result column="VIDEO_DESC" jdbcType="LONGVARCHAR" property="videoDesc" />
  </resultMap>
<resultMap id="BaseResultMapExtra"  type="com.louquanapp.dao.model.Video"  extends="BaseResultMap" >
    <result column="likeCount" jdbcType="INTEGER" property="likeCount" />
</resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 15 13:07:07 CST 2019.
    -->
    delete from dcdg_video_video_base
    where VIDEO_ID = #{videoId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.louquanapp.dao.model.Video">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 15 13:07:07 CST 2019.
    -->
    insert into dcdg_video_video_base (VIDEO_ID, VIDEO_TITLE, CAT_ID, 
      VIDEO_IMG, VIDEO_URL, VIDEO_PUSH_URL, 
      VIDEO_TIME, ONLINE_COUNT, ADD_TIME, 
      ADD_USER, ADD_USER_NAME, VIDEO_STATUS, 
      VIDEO_NO, CUST_ID, VIDEO_START_TIME, 
      VIDEO_END_TIME, REAL_START_TIME, REAL_END_TIME, 
      LOCATION, IS_REC, VIDEO_TYPE, 
      VIDEO_DESC)
    values (#{videoId,jdbcType=CHAR}, #{videoTitle,jdbcType=VARCHAR}, #{catId,jdbcType=CHAR}, 
      #{videoImg,jdbcType=VARCHAR}, #{videoUrl,jdbcType=VARCHAR}, #{videoPushUrl,jdbcType=VARCHAR}, 
      #{videoTime,jdbcType=INTEGER}, #{onlineCount,jdbcType=INTEGER}, #{addTime,jdbcType=TIMESTAMP}, 
      #{addUser,jdbcType=CHAR}, #{addUserName,jdbcType=VARCHAR}, #{videoStatus,jdbcType=TINYINT}, 
      #{videoNo,jdbcType=INTEGER}, #{custId,jdbcType=CHAR}, #{videoStartTime,jdbcType=TIMESTAMP}, 
      #{videoEndTime,jdbcType=TIMESTAMP}, #{realStartTime,jdbcType=TIMESTAMP}, #{realEndTime,jdbcType=TIMESTAMP}, 
      #{location,jdbcType=VARCHAR}, #{isRec,jdbcType=TINYINT}, #{videoType,jdbcType=TINYINT}, 
      #{videoDesc,jdbcType=LONGVARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.louquanapp.dao.model.Video">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 15 13:07:07 CST 2019.
    -->
    update dcdg_video_video_base
    set VIDEO_TITLE = #{videoTitle,jdbcType=VARCHAR},
      CAT_ID = #{catId,jdbcType=CHAR},
      VIDEO_IMG = #{videoImg,jdbcType=VARCHAR},
      VIDEO_URL = #{videoUrl,jdbcType=VARCHAR},
      VIDEO_PUSH_URL = #{videoPushUrl,jdbcType=VARCHAR},
      VIDEO_TIME = #{videoTime,jdbcType=INTEGER},
      ONLINE_COUNT = #{onlineCount,jdbcType=INTEGER},
      ADD_TIME = #{addTime,jdbcType=TIMESTAMP},
      ADD_USER = #{addUser,jdbcType=CHAR},
      ADD_USER_NAME = #{addUserName,jdbcType=VARCHAR},
      VIDEO_STATUS = #{videoStatus,jdbcType=TINYINT},
      VIDEO_NO = #{videoNo,jdbcType=INTEGER},
      CUST_ID = #{custId,jdbcType=CHAR},
      VIDEO_START_TIME = #{videoStartTime,jdbcType=TIMESTAMP},
      VIDEO_END_TIME = #{videoEndTime,jdbcType=TIMESTAMP},
      REAL_START_TIME = #{realStartTime,jdbcType=TIMESTAMP},
      REAL_END_TIME = #{realEndTime,jdbcType=TIMESTAMP},
      LOCATION = #{location,jdbcType=VARCHAR},
      IS_REC = #{isRec,jdbcType=TINYINT},
      VIDEO_TYPE = #{videoType,jdbcType=TINYINT},
      VIDEO_DESC = #{videoDesc,jdbcType=LONGVARCHAR}
    where VIDEO_ID = #{videoId,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">

    select VIDEO_ID, VIDEO_TITLE, CAT_ID, VIDEO_IMG, VIDEO_URL, VIDEO_PUSH_URL, VIDEO_TIME, 
    ONLINE_COUNT, ADD_TIME, ADD_USER, ADD_USER_NAME, VIDEO_STATUS, VIDEO_NO, CUST_ID, 
    VIDEO_START_TIME, VIDEO_END_TIME, REAL_START_TIME, REAL_END_TIME, LOCATION, IS_REC, 
    VIDEO_TYPE, VIDEO_DESC
    from dcdg_video_video_base
    where VIDEO_ID = #{videoId,jdbcType=CHAR}  and IS_DEL = 1
  </select>
  <select id="selectAll" resultMap="BaseResultMap">

    select VIDEO_ID, VIDEO_TITLE, CAT_ID, VIDEO_IMG, VIDEO_URL, VIDEO_PUSH_URL, VIDEO_TIME, 
    ONLINE_COUNT, ADD_TIME, ADD_USER, ADD_USER_NAME, VIDEO_STATUS, VIDEO_NO, CUST_ID, 
    VIDEO_START_TIME, VIDEO_END_TIME, REAL_START_TIME, REAL_END_TIME, LOCATION, IS_REC, 
    VIDEO_TYPE, VIDEO_DESC
    from dcdg_video_video_base  where   IS_DEL = 1
  </select>


    <select id="videoByCustId" resultMap="BaseResultMap">
    select VIDEO_ID, VIDEO_TITLE, CAT_ID, VIDEO_IMG, VIDEO_TIME,
    ONLINE_COUNT, ADD_TIME, VIDEO_STATUS, VIDEO_NO, CUST_ID,
    VIDEO_START_TIME, VIDEO_END_TIME, LOCATION, VIDEO_DESC,VIDEO_TYPE
    from dcdg_video_video_base where CUST_ID = #{custId,jdbcType=CHAR} and IS_DEL = 1 and VIDEO_TYPE=1
    and VIDEO_STATUS in(1,2,3,4)  and  VIDEO_END_TIME &gt; now()
   </select>




    <select id="selectMaxVideoNo" resultType="Integer">
    select max(VIDEO_NO)
    from dcdg_video_video_base
  </select>
    <update id="updateCountByPrimaryKey">
        update dcdg_video_video_base
        set
        ONLINE_COUNT = #{onlineCount,jdbcType=INTEGER}
        where VIDEO_ID = #{videoId,jdbcType=CHAR}
    </update>

    <!--修改直播转态为过期 直播状态[1-未开始 2-直播中 3-禁播 4-审核中 5-审核不通过 6-直播结束 7-过期] -->
    <update id="updateStatusByIds">
        update dcdg_video_video_base
        set
        VIDEO_STATUS = 7
        where    CUST_ID = #{custId,jdbcType=CHAR}
             and VIDEO_STATUS in(1,4,5)
             and  VIDEO_END_TIME &lt; now()
             and VIDEO_TYPE = 1
             and VIDEO_ID  in
            <foreach collection="list" item="id" open="(" separator="," close=")">#{id}</foreach>
    </update>


    <select id="selectCustIdByVideoId" resultType="String">
        select CUST_ID
        from dcdg_video_video_base    where VIDEO_ID = #{videoId,jdbcType=CHAR}  and IS_DEL = 1
    </select>

    <select id="videoValidRec" resultMap="BaseResultMap">
        select VIDEO_ID, VIDEO_TITLE, CAT_ID, VIDEO_IMG, VIDEO_TIME,
        ONLINE_COUNT, ADD_TIME, VIDEO_STATUS, VIDEO_NO, CUST_ID,VIDEO_TYPE,VIDEO_URL
        from dcdg_video_video_base where VIDEO_STATUS=2 and IS_DEL = 1 and IS_REC=1
        <if test="videoType != null ">
            and VIDEO_TYPE =  #{videoType,jdbcType=TINYINT}
        </if>

        ORDER BY ADD_TIME desc limit 2
    </select>


    <select id="videoValidCustIds" resultMap="BaseResultMap">
        select VIDEO_ID, VIDEO_TITLE, CAT_ID, VIDEO_IMG, VIDEO_TIME,
        ONLINE_COUNT, ADD_TIME, VIDEO_STATUS, VIDEO_NO, CUST_ID,VIDEO_TYPE
        from dcdg_video_video_base where VIDEO_STATUS=2  and IS_DEL = 1
        <if test="null!=keywords and keywords!='' ">
            AND ( VIDEO_TITLE like CONCAT('%',#{keywords,jdbcType=VARCHAR},'%') or VIDEO_NO like
            CONCAT('%',#{keywords,jdbcType=VARCHAR},'%') )
        </if>
        <if test="custIds != null and custIds.size()&gt;0">
            AND CUST_ID IN
            <foreach close=")" collection="custIds" item="id" open="(" separator=",">#{id}
            </foreach>
        </if>

        <if test="videoLists != null and videoLists.size()&gt;0">
            AND VIDEO_ID not IN
            <foreach close=")" collection="videoLists" item="id" open="(" separator=",">#{id}
            </foreach>
        </if>




    </select>

    <select id="videoValid" resultMap="BaseResultMap">
        select VIDEO_ID, VIDEO_TITLE, CAT_ID, VIDEO_IMG, VIDEO_TIME,
        ONLINE_COUNT, ADD_TIME, VIDEO_STATUS, VIDEO_NO, CUST_ID,VIDEO_TYPE
        from dcdg_video_video_base where VIDEO_STATUS=2  and IS_DEL = 1
        <if test="catId!=null and catId!='' ">
            and CAT_ID = #{catId,jdbcType=CHAR}
        </if>
        <if test="null!=keywords and keywords!='' ">
            AND ( VIDEO_TITLE like CONCAT('%',#{keywords,jdbcType=VARCHAR},'%') or VIDEO_NO like
            CONCAT('%',#{keywords,jdbcType=VARCHAR},'%')   )

        </if>
        <if test="videoList != null and videoList.size()&gt;0">
            AND VIDEO_ID not IN
            <foreach close=")" collection="videoList" item="id" open="(" separator=",">#{id}
            </foreach>
        </if>




    </select>
<!--查询我的短视频作品列表-->
    <select id="videoWorks" resultMap="BaseResultMapExtra">
        select a.VIDEO_ID, a.VIDEO_TITLE, a.VIDEO_IMG, a.VIDEO_PUSH_URL,ADD_TIME,
        (select count(ATTENTION_ID) from dcdg_customer_attention_base where SOURCE_ID = a.VIDEO_ID  and ATTENTION_TYPE=1 ) likeCount
        from dcdg_video_video_base a

         where a.VIDEO_TYPE=2  and a.IS_DEL = 1 and a.PUTAWAY_FLAG=4 and a.VIDEO_STATUS = 2
         and  a.CUST_ID = #{custId,jdbcType=CHAR}

    </select>


    <select id="queryPullBackByCustId" parameterType="java.lang.String" resultMap="BaseResultMap">

    select VIDEO_ID, VIDEO_TITLE, CAT_ID, VIDEO_IMG, VIDEO_TIME,
            ONLINE_COUNT, ADD_TIME, VIDEO_STATUS, VIDEO_NO, CUST_ID,VIDEO_TYPE
            from dcdg_video_video_base where VIDEO_ID in
            (
               select VIDEO_ID  from dcdg_video_pull_black where CUST_ID = #{custId,jdbcType=CHAR}
            )


  </select>

    <select id="queryVideoIdsByCustId" resultType="String">
        select VIDEO_ID   from dcdg_video_video_base where
          IS_DEL = 1 and PUTAWAY_FLAG=4
         and CUST_ID in
        <foreach close=")" collection="custIds" item="id" open="(" separator=",">#{id}
        </foreach>

    </select>

    <update id="delVideo" >
        update dcdg_video_video_base  set IS_DEL = 2  where   CUST_ID = #{custId,jdbcType=CHAR}
            and  VIDEO_ID in
        <foreach close=")" collection="videoIds" item="id" open="(" separator=",">#{id}
        </foreach>
    </update>

    <select id="queryVideoUrlsByVideoIds" resultType="String">
        select VIDEO_URL   from dcdg_video_video_base where
            VIDEO_ID in
        <foreach close=")" collection="videoIds" item="id" open="(" separator=",">#{id}
        </foreach>

    </select>

</mapper>