<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.louquanapp.dao.mapper.CustomerPointMapper">
    <resultMap id="BaseResultMap" type="com.louquanapp.dao.model.CustomerPoint">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 10 17:27:32 CST 2019.
        -->
        <id column="POINT_ID" jdbcType="CHAR" property="pointId"/>
        <result column="CUST_ID" jdbcType="CHAR" property="custId"/>
        <result column="POINT_VALUE" jdbcType="DOUBLE" property="pointValue"/>
        <result column="GAIN_TYPE" jdbcType="TINYINT" property="gainType"/>
        <result column="POINT_DESC" jdbcType="VARCHAR" property="pointDesc"/>
        <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime"/>
        <result column="POINT_TYPE" jdbcType="TINYINT" property="pointType"/>
        <result column="SOURCE_TYPE" jdbcType="TINYINT" property="sourceType"/>
        <result column="SOURCE_ID" jdbcType="CHAR" property="sourceId"/>
        <result column="AUDIT_USER" jdbcType="CHAR" property="auditUser"/>
        <result column="AUDIT_USER_NAME" jdbcType="VARCHAR" property="auditUserName"/>
        <result column="AUDIT_TIME" jdbcType="TIMESTAMP" property="auditTime"/>
        <result column="REFUSE_REASON" jdbcType="VARCHAR" property="refuseReason"/>
        <result column="AUDIT_STATUS" jdbcType="TINYINT" property="auditStatus"/>
        <result column="POINT_MOLD" jdbcType="TINYINT" property="pointMold"/>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 10 17:27:32 CST 2019.
        -->
        delete from dcdg_bussiness_customer_point
        where POINT_ID = #{pointId,jdbcType=CHAR}
    </delete>
    <insert id="insert" parameterType="com.louquanapp.dao.model.CustomerPoint">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 10 17:27:32 CST 2019.
        -->
        insert into dcdg_bussiness_customer_point (POINT_ID, CUST_ID, POINT_VALUE,
        GAIN_TYPE, POINT_DESC, ADD_TIME,
        POINT_TYPE, SOURCE_TYPE, SOURCE_ID,
        AUDIT_USER, AUDIT_USER_NAME, AUDIT_TIME,
        REFUSE_REASON, AUDIT_STATUS,POINT_MOLD)
        values (#{pointId,jdbcType=CHAR}, #{custId,jdbcType=CHAR}, #{pointValue,jdbcType=DOUBLE},
        #{gainType,jdbcType=TINYINT}, #{pointDesc,jdbcType=VARCHAR}, #{addTime,jdbcType=TIMESTAMP},
        #{pointType,jdbcType=TINYINT}, #{sourceType,jdbcType=TINYINT}, #{sourceId,jdbcType=CHAR},
        #{auditUser,jdbcType=CHAR}, #{auditUserName,jdbcType=VARCHAR}, #{auditTime,jdbcType=TIMESTAMP},
        #{refuseReason,jdbcType=VARCHAR}, #{auditStatus,jdbcType=TINYINT}, #{pointMold,jdbcType=TINYINT})
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.louquanapp.dao.model.CustomerPoint">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 10 17:27:32 CST 2019.
        -->
        update dcdg_bussiness_customer_point
        set CUST_ID = #{custId,jdbcType=CHAR},
        POINT_VALUE = #{pointValue,jdbcType=DOUBLE},
        GAIN_TYPE = #{gainType,jdbcType=TINYINT},
        POINT_DESC = #{pointDesc,jdbcType=VARCHAR},
        ADD_TIME = #{addTime,jdbcType=TIMESTAMP},
        POINT_TYPE = #{pointType,jdbcType=TINYINT},
        SOURCE_TYPE = #{sourceType,jdbcType=TINYINT},
        SOURCE_ID = #{sourceId,jdbcType=CHAR},
        AUDIT_USER = #{auditUser,jdbcType=CHAR},
        AUDIT_USER_NAME = #{auditUserName,jdbcType=VARCHAR},
        AUDIT_TIME = #{auditTime,jdbcType=TIMESTAMP},
        REFUSE_REASON = #{refuseReason,jdbcType=VARCHAR},
        AUDIT_STATUS = #{auditStatus,jdbcType=TINYINT},
        POINT_MOLD = #{pointMold,jdbcType=TINYINT}
        where POINT_ID = #{pointId,jdbcType=CHAR}
    </update>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 10 17:27:32 CST 2019.
        -->
        select POINT_ID, CUST_ID, POINT_VALUE, GAIN_TYPE, POINT_DESC, ADD_TIME, POINT_TYPE,
        SOURCE_TYPE, SOURCE_ID, AUDIT_USER, AUDIT_USER_NAME, AUDIT_TIME, REFUSE_REASON, AUDIT_STATUS,POINT_MOLD
        from dcdg_bussiness_customer_point
        where POINT_ID = #{pointId,jdbcType=CHAR}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 10 17:27:32 CST 2019.
        -->
        select POINT_ID, CUST_ID, POINT_VALUE, GAIN_TYPE, POINT_DESC, ADD_TIME, POINT_TYPE,
        SOURCE_TYPE, SOURCE_ID, AUDIT_USER, AUDIT_USER_NAME, AUDIT_TIME, REFUSE_REASON, AUDIT_STATUS,POINT_MOLD
        from dcdg_bussiness_customer_point
    </select>

    <!--[1-商城订单 2-其他订单 3-邀请注册赠送 4-邀请首次消费赠送 5-游戏 6-签到] -->
    <select id="sumInvite" resultType="java.lang.Double">
    select sum(POINT_VALUE)
    from dcdg_bussiness_customer_point where  AUDIT_STATUS=2 and SOURCE_TYPE in(3,4) and GAIN_TYPE=1  and CUST_ID = #{custId,jdbcType=CHAR}
  </select>
    <!--[1-商城订单 2-其他订单 3-邀请注册赠送 4-邀请首次消费赠送 5-游戏 6-签到] -->
    <select id="sumInviteForregister" resultType="java.lang.Double">
    select sum(POINT_VALUE)
    from dcdg_bussiness_customer_point where  AUDIT_STATUS=2 and SOURCE_TYPE =3 and GAIN_TYPE=1

      and CUST_ID = #{custId,jdbcType=CHAR}
        <if test="pointMold !=null ">
            AND POINT_MOLD = #{pointMold,jdbcType=TINYINT}
        </if>

  </select>
    <!--日游戏获得统计-->
    <select id="dayGamePoint" resultType="double">
    select IFNULL(SUM(POINT_VALUE),0) as POINT_VALUE
    from dcdg_bussiness_customer_point where  AUDIT_STATUS=2 and SOURCE_TYPE =5 and GAIN_TYPE=1 and CUST_ID = #{custId,jdbcType=CHAR}
    and to_days(AUDIT_TIME) = to_days(now());

  </select>
    <!--日签到积分统计-->
    <select id="daySignPoint" resultType="int">
    select count(1)
    from dcdg_bussiness_customer_point where  AUDIT_STATUS=2 and SOURCE_TYPE =6 and GAIN_TYPE=1 and CUST_ID = #{custId,jdbcType=CHAR}
    and to_days(AUDIT_TIME) = to_days(now());

  </select>
    <select id="weekSignPoint" resultType="int">
    SELECT count(1) FROM dcdg_bussiness_customer_point WHERE YEARWEEK(date_format(ADD_TIME,'%Y-%m-%d'),1) = YEARWEEK(now(),1)
    and AUDIT_STATUS=2 and SOURCE_TYPE =6 and GAIN_TYPE=1 and CUST_ID = #{custId,jdbcType=CHAR}
    </select>


    <select id="customerPointOrBalance" resultMap="BaseResultMap">
         select POINT_ID, CUST_ID, POINT_VALUE, GAIN_TYPE, POINT_DESC, ADD_TIME, POINT_TYPE,
        SOURCE_TYPE, SOURCE_ID, AUDIT_USER, AUDIT_USER_NAME, AUDIT_TIME, REFUSE_REASON, AUDIT_STATUS,POINT_MOLD
        from dcdg_bussiness_customer_point
        <where>
            <if test="gainType ==1 or  gainType ==2 ">
                and GAIN_TYPE = #{gainType,jdbcType=TINYINT}
            </if>
            <if test="pointType ==1 or  pointType ==3 ">
                and POINT_TYPE = #{pointType,jdbcType=TINYINT}
            </if>
            <if test="custId !=null and custId !='' ">
                and CUST_ID = #{custId,jdbcType=CHAR}
            </if>

        </where>


    </select>

    <select id="customerPointOrBalanceCount" resultType="Double">
        <if test="type !=null and type ==1 ">
            select SURPLUS_TOTAL_POINT from dcdg_bussiness_customer_account where CUST_ID = #{custId,jdbcType=CHAR}
        </if>
        <if test="type !=null and type ==2 ">
            select CONSUME_POINT from dcdg_bussiness_customer_base where CUST_ID = #{custId,jdbcType=CHAR}
        </if>

    </select>


</mapper>