<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.louquanapp.dao.mapper.VideoPlaninfoMapper">
  <resultMap id="BaseResultMap" type="com.louquanapp.dao.model.VideoPlaninfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 16 10:30:46 CST 2019.
    -->
    <id column="PLAN_ID" jdbcType="CHAR" property="planId" />
    <result column="PLAN_NUM" jdbcType="TINYINT" property="planNum" />
    <result column="PLAN_DATE" jdbcType="VARCHAR" property="planDate" />
    <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime" />
    <result column="CUST_ID" jdbcType="CHAR" property="custId" />
    <result column="CUST_NAME" jdbcType="VARCHAR" property="custName" />
    <result column="CUST_PHONE" jdbcType="CHAR" property="custPhone" />
    <result column="SHOP_ID" jdbcType="CHAR" property="shopId" />
    <result column="VIDEO_ID" jdbcType="CHAR" property="videoId" />
    <result column="PLAN_STATUS" jdbcType="TINYINT" property="planStatus" />
    <result column="REMARKS" jdbcType="VARCHAR" property="remarks" />
    <result column="CHILD_ID" jdbcType="CHAR" property="childId" />
    <result column="ORDER_ID" jdbcType="CHAR" property="orderId" />
    <result column="PLAN_IMG" jdbcType="VARCHAR" property="planImg" />
    <result column="IS_DEL" jdbcType="TINYINT" property="isDel" />
    <result column="REPLY" jdbcType="VARCHAR" property="reply" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 16 10:30:46 CST 2019.
    -->
    delete from dcdg_video_planinfo_base
    where PLAN_ID = #{planId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.louquanapp.dao.model.VideoPlaninfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 16 10:30:46 CST 2019.
    -->
    insert into dcdg_video_planinfo_base (PLAN_ID, PLAN_NUM, PLAN_DATE, 
      ADD_TIME, CUST_ID, CUST_NAME, 
      CUST_PHONE, SHOP_ID, VIDEO_ID, 
      PLAN_STATUS, REMARKS, CHILD_ID, 
      ORDER_ID, PLAN_IMG, IS_DEL, 
      REPLY)
    values (#{planId,jdbcType=CHAR}, #{planNum,jdbcType=TINYINT}, #{planDate,jdbcType=VARCHAR}, 
      #{addTime,jdbcType=TIMESTAMP}, #{custId,jdbcType=CHAR}, #{custName,jdbcType=VARCHAR}, 
      #{custPhone,jdbcType=CHAR}, #{shopId,jdbcType=CHAR}, #{videoId,jdbcType=CHAR}, 
      #{planStatus,jdbcType=TINYINT}, #{remarks,jdbcType=VARCHAR}, #{childId,jdbcType=CHAR}, 
      #{orderId,jdbcType=CHAR}, #{planImg,jdbcType=VARCHAR}, #{isDel,jdbcType=TINYINT}, 
      #{reply,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.louquanapp.dao.model.VideoPlaninfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 16 10:30:46 CST 2019.
    -->
    update dcdg_video_planinfo_base
    set PLAN_NUM = #{planNum,jdbcType=TINYINT},
      PLAN_DATE = #{planDate,jdbcType=VARCHAR},
      ADD_TIME = #{addTime,jdbcType=TIMESTAMP},
      CUST_ID = #{custId,jdbcType=CHAR},
      CUST_NAME = #{custName,jdbcType=VARCHAR},
      CUST_PHONE = #{custPhone,jdbcType=CHAR},
      SHOP_ID = #{shopId,jdbcType=CHAR},
      VIDEO_ID = #{videoId,jdbcType=CHAR},
      PLAN_STATUS = #{planStatus,jdbcType=TINYINT},
      REMARKS = #{remarks,jdbcType=VARCHAR},
      CHILD_ID = #{childId,jdbcType=CHAR},
      ORDER_ID = #{orderId,jdbcType=CHAR},
      PLAN_IMG = #{planImg,jdbcType=VARCHAR},
      IS_DEL = #{isDel,jdbcType=TINYINT},
      REPLY = #{reply,jdbcType=VARCHAR}
    where PLAN_ID = #{planId,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 16 10:30:46 CST 2019.
    -->
    select PLAN_ID, PLAN_NUM, PLAN_DATE, ADD_TIME, CUST_ID, CUST_NAME, CUST_PHONE, SHOP_ID, 
    VIDEO_ID, PLAN_STATUS, REMARKS, CHILD_ID, ORDER_ID, PLAN_IMG, IS_DEL, REPLY
    from dcdg_video_planinfo_base
    where PLAN_ID = #{planId,jdbcType=CHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 16 10:30:46 CST 2019.
    -->
    select PLAN_ID, PLAN_NUM, PLAN_DATE, ADD_TIME, CUST_ID, CUST_NAME, CUST_PHONE, SHOP_ID, 
    VIDEO_ID, PLAN_STATUS, REMARKS, CHILD_ID, ORDER_ID, PLAN_IMG, IS_DEL, REPLY
    from dcdg_video_planinfo_base
  </select>
  <resultMap extends="BaseResultMap" id="BaseResultExtraMap" type="com.louquanapp.dao.model.VideoPlaninfo">
    <result column="SHOP_NAME" jdbcType="VARCHAR" property="shopName" />
    <result column="isOverdue" jdbcType="VARCHAR" property="isOverdue" />

  </resultMap>

  <!--查询直播间预定信息列表-->
 <select id="videoPlaninfoList" resultMap="BaseResultExtraMap">

   select a.PLAN_ID, a.PLAN_NUM, a.PLAN_DATE, a.ADD_TIME, a.CUST_ID, a.CUST_NAME, a.CUST_PHONE, a.SHOP_ID,
   a.VIDEO_ID, a.PLAN_STATUS, a.REMARKS,a.REPLY,b.SHOP_NAME
    from dcdg_video_planinfo_base a  left join dcdg_goods_shop_base b on a.SHOP_ID = b.SHOP_ID
     <where>
        and a.IS_DEL = 1
        and  a.SHOP_ID = #{shopId,jdbcType=CHAR}
       <if test=" planStatus != null and planStatus == 1 ">
         and a.PLAN_STATUS = 1  and a.PLAN_DATE &gt; now()
       </if>
       <if test=" planStatus != null and planStatus == 2 ">
         and a.PLAN_STATUS = 2  and a.PLAN_DATE &gt; now()
       </if>
       <if test=" planStatus != null and planStatus == 3 ">
         and a.PLAN_STATUS in (3,4,5)
       </if>
     </where>
 </select>

  <select id="videoPlaninfoDetail" resultMap="BaseResultExtraMap">

    select a.PLAN_ID, a.PLAN_NUM, a.PLAN_DATE, a.ADD_TIME, a.CUST_ID, a.CUST_NAME, a.CUST_PHONE, a.SHOP_ID,
    a.VIDEO_ID, a.PLAN_STATUS, a.REMARKS,a.REPLY,b.SHOP_NAME
    from dcdg_video_planinfo_base a  left join dcdg_goods_shop_base b on a.SHOP_ID = b.SHOP_ID
    <where>
      and  a.IS_DEL = 1
      and  a.SHOP_ID = #{shopId,jdbcType=CHAR}
      and  a.PLAN_ID = #{planId,jdbcType=CHAR}
    </where>
  </select>


  <!--根据planId custId 删除直播间预定信息-->
  <update id="deleteVideoPlaninfoByPlanIdAndcCustId">
    update  dcdg_video_planinfo_base  set    IS_DEL = 2
    where PLAN_ID = #{planId,jdbcType=CHAR}  and  SHOP_ID  = #{shopId,jdbcType=CHAR}

  </update>
  <!--根据条件修改直播间预定信息-->
  <update id="updateVideoPlaninfo" parameterType="com.louquanapp.dao.model.VideoPlaninfo">

    update dcdg_video_planinfo_base
    <set>
      <if test=" planNum != null">
      PLAN_NUM = #{planNum,jdbcType=TINYINT},
      </if>
      <if test=" planDate != null and planDate !='' ">
      PLAN_DATE = #{planDate,jdbcType=VARCHAR},
      </if>
      <if test=" addTime != null">
      ADD_TIME = #{addTime,jdbcType=TIMESTAMP},
      </if>
      <if test=" custId != null and custId !='' ">
      CUST_ID = #{custId,jdbcType=CHAR},
      </if>
      <if test=" custName != null">
      CUST_NAME = #{custName,jdbcType=VARCHAR},
      </if>
      <if test=" custPhone != null">
      CUST_PHONE = #{custPhone,jdbcType=CHAR},
      </if>
      <if test=" shopId != null">
      SHOP_ID = #{shopId,jdbcType=CHAR},
      </if>
      <if test=" videoId != null">
      VIDEO_ID = #{videoId,jdbcType=CHAR},
      </if>
      <if test=" planStatus != null">
      PLAN_STATUS = #{planStatus,jdbcType=TINYINT}
      </if>
    </set>
    where PLAN_ID = #{planId,jdbcType=CHAR}
    and IS_DEL = 1


  </update>

  <select id="queryPlaninfoByOrderId" resultMap="BaseResultMap">
     select PLAN_ID, PLAN_NUM, PLAN_DATE, ADD_TIME, CUST_ID, CUST_NAME, CUST_PHONE, SHOP_ID,
    VIDEO_ID, PLAN_STATUS, REMARKS, CHILD_ID, ORDER_ID
    from dcdg_video_planinfo_base  where   ORDER_ID = #{orderId,jdbcType=CHAR}  and IS_DEL = 1
  </select>
    <!--操作方式[1-商家确认 2-商家取消 3-结束]-->
  <update id="planinfoUpdateStatus" >
    update dcdg_video_planinfo_base
     <set>
       <if test=" planStatus != null and planStatus ==1 ">
         PLAN_STATUS = 2,
       </if>
       <if test=" planStatus != null and planStatus ==2 and  reply != null and reply !=''">
         PLAN_STATUS = 3,
         REPLY = #{reply,jdbcType=VARCHAR},
       </if>
       <if test=" planStatus != null and planStatus ==3 ">
         PLAN_STATUS = 5,
       </if>
     </set>
    where    IS_DEL = 1
       and   PLAN_ID = #{planId,jdbcType=CHAR}
       and   SHOP_ID = #{shopId,jdbcType=CHAR}
    <if test=" planStatus != null and planStatus ==1 ">
       and   PLAN_DATE &gt; now()
    </if>
    <if test=" planStatus != null and planStatus ==3 ">
      and   PLAN_DATE &gt; now()
      and    PLAN_STATUS = 2
    </if>

      </update>

  <select id="queryPlaninfoStatus" resultType="Byte">
     select PLAN_STATUS  from dcdg_video_planinfo_base
          where    IS_DEL = 1
             and   PLAN_ID = #{planId,jdbcType=CHAR}
             and   SHOP_ID = #{shopId,jdbcType=CHAR}

  </select>

  <select id="queryPlaninfoByPlanId"  resultMap="BaseResultMap">
     select CUST_ID,PLAN_STATUS  from dcdg_video_planinfo_base
          where    IS_DEL = 1
             and   PLAN_ID = #{planId,jdbcType=CHAR}
             and   SHOP_ID = #{shopId,jdbcType=CHAR}

  </select>

  <update id="updateOverByOrderId">
    update dcdg_video_planinfo_base  set PLAN_STATUS =5
    where    IS_DEL = 1
             and   ORDER_ID = #{orderId,jdbcType=CHAR}
             and   SHOP_ID  = #{shopId,jdbcType=CHAR}
  </update>
<!--
  int planinfoUpdateStatus(@Param("planId") String planId,@Param("shopId") String shopId
  ,@Param("planStatus") Byte planStatus, @Param("reply") String reply);-->


</mapper>