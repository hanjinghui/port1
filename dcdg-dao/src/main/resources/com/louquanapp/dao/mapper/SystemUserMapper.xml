<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.louquanapp.dao.mapper.SystemUserMapper">
  <resultMap id="BaseResultMap" type="com.louquanapp.dao.model.SystemUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 25 18:44:24 CST 2019.
    -->
    <id column="USER_ID" jdbcType="CHAR" property="userId" />
    <result column="USER_ACCT" jdbcType="VARCHAR" property="userAcct" />
    <result column="USER_NAME" jdbcType="VARCHAR" property="userName" />
    <result column="USER_PWD" jdbcType="CHAR" property="userPwd" />
    <result column="ACTIVE_FLAG" jdbcType="TINYINT" property="activeFlag" />
    <result column="DFT_THEME" jdbcType="VARCHAR" property="dftTheme" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
    <result column="PC_ONLINE_FLAG" jdbcType="TINYINT" property="pcOnlineFlag" />
    <result column="ERR_COUNT" jdbcType="TINYINT" property="errCount" />
    <result column="ERR_TIME" jdbcType="TIMESTAMP" property="errTime" />
    <result column="JPUSH_REG_ID" jdbcType="VARCHAR" property="jpushRegId" />
    <result column="ORG_NAME" jdbcType="VARCHAR" property="orgName" />
    <result column="ORG_PHONE" jdbcType="VARCHAR" property="orgPhone" />
    <result column="HEAD_IMG" jdbcType="VARCHAR" property="headImg" />
    <result column="CUST_ID" jdbcType="VARCHAR" property="custId" />
    <result column="CONSUME_POINT" jdbcType="DOUBLE" property="consumePoint" />
    <result column="DEDUCTION_POINT" jdbcType="DOUBLE" property="deductionPoint" />
    <result column="RELATION_LEVEL" jdbcType="TINYINT" property="relationLevel" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 25 18:44:24 CST 2019.
    -->
    delete from andji_system_user_base
    where USER_ID = #{userId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.louquanapp.dao.model.SystemUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 25 18:44:24 CST 2019.
    -->
    insert into andji_system_user_base (USER_ID, USER_ACCT, USER_NAME, 
      USER_PWD, ACTIVE_FLAG, DFT_THEME, 
      CREATE_TIME, PC_ONLINE_FLAG, ERR_COUNT, 
      ERR_TIME, JPUSH_REG_ID, ORG_NAME, 
      ORG_PHONE, HEAD_IMG, CUST_ID, 
      CONSUME_POINT, DEDUCTION_POINT, RELATION_LEVEL
      )
    values (#{userId,jdbcType=CHAR}, #{userAcct,jdbcType=VARCHAR}, #{userName,jdbcType=VARCHAR}, 
      #{userPwd,jdbcType=CHAR}, #{activeFlag,jdbcType=TINYINT}, #{dftTheme,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{pcOnlineFlag,jdbcType=TINYINT}, #{errCount,jdbcType=TINYINT}, 
      #{errTime,jdbcType=TIMESTAMP}, #{jpushRegId,jdbcType=VARCHAR}, #{orgName,jdbcType=VARCHAR}, 
      #{orgPhone,jdbcType=VARCHAR}, #{headImg,jdbcType=VARCHAR}, #{custId,jdbcType=VARCHAR}, 
      #{consumePoint,jdbcType=DOUBLE}, #{deductionPoint,jdbcType=DOUBLE}, #{relationLevel,jdbcType=TINYINT}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.louquanapp.dao.model.SystemUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 25 18:44:24 CST 2019.
    -->
    update andji_system_user_base
    set USER_ACCT = #{userAcct,jdbcType=VARCHAR},
      USER_NAME = #{userName,jdbcType=VARCHAR},
      USER_PWD = #{userPwd,jdbcType=CHAR},
      ACTIVE_FLAG = #{activeFlag,jdbcType=TINYINT},
      DFT_THEME = #{dftTheme,jdbcType=VARCHAR},
      CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      PC_ONLINE_FLAG = #{pcOnlineFlag,jdbcType=TINYINT},
      ERR_COUNT = #{errCount,jdbcType=TINYINT},
      ERR_TIME = #{errTime,jdbcType=TIMESTAMP},
      JPUSH_REG_ID = #{jpushRegId,jdbcType=VARCHAR},
      ORG_NAME = #{orgName,jdbcType=VARCHAR},
      ORG_PHONE = #{orgPhone,jdbcType=VARCHAR},
      HEAD_IMG = #{headImg,jdbcType=VARCHAR},
      CUST_ID = #{custId,jdbcType=VARCHAR},
      CONSUME_POINT = #{consumePoint,jdbcType=DOUBLE},
      DEDUCTION_POINT = #{deductionPoint,jdbcType=DOUBLE},
      RELATION_LEVEL = #{relationLevel,jdbcType=TINYINT}
    where USER_ID = #{userId,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 25 18:44:24 CST 2019.
    -->
    select USER_ID, USER_ACCT, USER_NAME, USER_PWD, ACTIVE_FLAG, DFT_THEME, CREATE_TIME, 
    PC_ONLINE_FLAG, ERR_COUNT, ERR_TIME, JPUSH_REG_ID, ORG_NAME, ORG_PHONE, HEAD_IMG, 
    CUST_ID, CONSUME_POINT, DEDUCTION_POINT, RELATION_LEVEL
    from andji_system_user_base
    where USER_ID = #{userId,jdbcType=CHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 25 18:44:24 CST 2019.
    -->
    select USER_ID, USER_ACCT, USER_NAME, USER_PWD, ACTIVE_FLAG, DFT_THEME, CREATE_TIME, 
    PC_ONLINE_FLAG, ERR_COUNT, ERR_TIME, JPUSH_REG_ID, ORG_NAME, ORG_PHONE, HEAD_IMG, 
    CUST_ID, CONSUME_POINT, DEDUCTION_POINT, RELATION_LEVEL
    from andji_system_user_base
  </select>

  <select id="queryUserByUserAcct" resultMap="BaseResultMap">

    select USER_ID, USER_ACCT, USER_NAME, USER_PWD, ACTIVE_FLAG, DFT_THEME, CREATE_TIME,
    PC_ONLINE_FLAG, ERR_COUNT, ERR_TIME, JPUSH_REG_ID, ORG_NAME, ORG_PHONE, HEAD_IMG,
    CUST_ID
    from andji_system_user_base  where  PC_ONLINE_FLAG=2 and  ACTIVE_FLAG=1 and  USER_ACCT = #{userAcct,jdbcType=VARCHAR}
  </select>


  <select id="queryUserPwdByUserId" resultType="String">
     select USER_PWD from andji_system_user_base  where  PC_ONLINE_FLAG=2 and  ACTIVE_FLAG=1
        and  USER_ID = #{userId,jdbcType=CHAR}
  </select>
  <update id="updateUserPwd" parameterType="com.louquanapp.dao.model.SystemUser">
    update andji_system_user_base set  USER_PWD = #{userPwd,jdbcType=CHAR}
       where  PC_ONLINE_FLAG=2 and  ACTIVE_FLAG=1 and  USER_ID = #{userId,jdbcType=CHAR}
  </update>

  <update id="updateErrLoginCount" parameterType="com.louquanapp.dao.model.SystemUser">
    update andji_system_user_base set  ERR_COUNT = #{errCount,jdbcType=TINYINT},
      ERR_TIME = now()  where USER_ID = #{userId,jdbcType=CHAR}

  </update>

  <select id="queryCustIdByUserId" parameterType="String" resultType="String">
      select CUST_ID  from  dcdg_goods_shop_base  where SHOP_ID =
          (select JPUSH_REG_ID from andji_system_user_base   where USER_ID = #{userId,jdbcType=CHAR})
  </select>
  <select id="queryShopIdByUserId" parameterType="String" resultType="String">
      select JPUSH_REG_ID from andji_system_user_base   where USER_ID = #{userId,jdbcType=CHAR}
  </select>
  <select id="queryUserNameByUserId" parameterType="String" resultType="String">
      select USER_NAME from andji_system_user_base   where USER_ID = #{userId,jdbcType=CHAR}
  </select>

  <select id="queryTotalMoney" parameterType="String" resultMap="BaseResultMap">
    select 	ifnull(CONSUME_POINT,0) CONSUME_POINT ,ifnull(DEDUCTION_POINT,0) DEDUCTION_POINT
    from andji_system_user_base  where USER_ID = #{userId,jdbcType=CHAR}
  </select>


  <select id="queryCustIdsByUserIds" resultType="String">
      select CUST_ID  from  dcdg_goods_shop_base  where SHOP_ID in
          (
           select JPUSH_REG_ID from andji_system_user_base
           where  USER_ID in
            <foreach close=")" collection="userIds" item="id" open="(" separator=",">#{id}
            </foreach>
          )
  </select>
  <select id="queryShopIdsByUserIds" resultType="String">
      select JPUSH_REG_ID from andji_system_user_base
      where  USER_ID in
      <foreach close=")" collection="userIds" item="id" open="(" separator=",">#{id}
      </foreach>
  </select>

  
  <select id="queryRelationLevelByUserId"  resultType="String">
           select RELATION_LEVEL from andji_system_user_base  where USER_ID = #{userId,jdbcType=CHAR}

  </select>


  <select id="existUserAcct"  resultType="Integer">
           select count(1) from andji_system_user_base  where USER_ACCT = #{userAcct,jdbcType=VARCHAR}

  </select>
</mapper>