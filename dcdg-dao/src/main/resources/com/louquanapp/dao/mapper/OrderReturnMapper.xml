<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.louquanapp.dao.mapper.OrderReturnMapper">
  <resultMap id="BaseResultMap" type="com.louquanapp.dao.model.OrderReturn">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 17 14:37:13 CST 2019.
    -->
    <id column="RETURN_ID" jdbcType="CHAR" property="returnId" />
    <result column="ORDER_ID" jdbcType="CHAR" property="orderId" />
    <result column="CHILD_ID" jdbcType="CHAR" property="childId" />
    <result column="GOODS_ID" jdbcType="CHAR" property="goodsId" />
    <result column="SELLER_ID" jdbcType="CHAR" property="sellerId" />
    <result column="SELLER_NAME" jdbcType="VARCHAR" property="sellerName" />
    <result column="BUYER_ID" jdbcType="CHAR" property="buyerId" />
    <result column="BUYER_NAME" jdbcType="VARCHAR" property="buyerName" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="RETURN_CONT" jdbcType="VARCHAR" property="returnCont" />
    <result column="ADD_TIME" jdbcType="TIMESTAMP" property="addTime" />
    <result column="REPLY_CONT" jdbcType="VARCHAR" property="replyCont" />
    <result column="REPLY_TIME" jdbcType="TIMESTAMP" property="replyTime" />
    <result column="SKU_VAL" jdbcType="VARCHAR" property="skuVal" />
    <result column="RETURN_STATUS" jdbcType="TINYINT" property="returnStatus" />
    <result column="GOOD_STATUS" jdbcType="TINYINT" property="goodStatus" />
    <result column="SERVER_STATUS" jdbcType="TINYINT" property="serverStatus" />
    <result column="RETURN_IMG" jdbcType="VARCHAR" property="returnImg" />
    <result column="IS_PROMOTION" jdbcType="TINYINT" property="isPromotion" />
    <result column="RETURN_MONEY" jdbcType="DOUBLE" property="returnMoney" />
  </resultMap>

  <resultMap id="ExtraBaseResultMap" type="com.louquanapp.dao.model.OrderReturn" extends="BaseResultMap">
    <result column="PAY_TYPE" jdbcType="TINYINT" property="payType" />
    <result column="ORDER_STATUS" jdbcType="INTEGER" property="orderStatus" />
    <result column="GOODS_NAME" jdbcType="VARCHAR" property="goodsName" />
    <result column="GOODS_IMG" jdbcType="VARCHAR" property="goodsImg" />
    <result column="GOODS_NUM" jdbcType="INTEGER" property="goodsNum" />
    <result column="TOTAL_FEE" jdbcType="DOUBLE" property="totalFee" />
    <result column="SKU_GOODS_NAME" jdbcType="VARCHAR" property="skuGoodsName" />
      <result column="PUTAWAY_PRICE" jdbcType="VARCHAR" property="putawayPrice" />

  </resultMap>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 17 14:37:13 CST 2019.
    -->
    delete from dcdg_bussiness_order_return
    where RETURN_ID = #{returnId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.louquanapp.dao.model.OrderReturn">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 17 14:37:13 CST 2019.
    -->
    insert into dcdg_bussiness_order_return (RETURN_ID, ORDER_ID, CHILD_ID, 
      GOODS_ID, SELLER_ID, SELLER_NAME, 
      BUYER_ID, BUYER_NAME, REMARK, 
      RETURN_CONT, ADD_TIME, REPLY_CONT, 
      REPLY_TIME, SKU_VAL, RETURN_STATUS, 
      GOOD_STATUS, SERVER_STATUS, RETURN_IMG, 
      IS_PROMOTION, RETURN_MONEY)
    values (#{returnId,jdbcType=CHAR}, #{orderId,jdbcType=CHAR}, #{childId,jdbcType=CHAR}, 
      #{goodsId,jdbcType=CHAR}, #{sellerId,jdbcType=CHAR}, #{sellerName,jdbcType=VARCHAR}, 
      #{buyerId,jdbcType=CHAR}, #{buyerName,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, 
      #{returnCont,jdbcType=VARCHAR}, #{addTime,jdbcType=TIMESTAMP}, #{replyCont,jdbcType=VARCHAR}, 
      #{replyTime,jdbcType=TIMESTAMP}, #{skuVal,jdbcType=VARCHAR}, #{returnStatus,jdbcType=TINYINT}, 
      #{goodStatus,jdbcType=TINYINT}, #{serverStatus,jdbcType=TINYINT}, #{returnImg,jdbcType=VARCHAR}, 
      #{isPromotion,jdbcType=TINYINT}, #{returnMoney,jdbcType=DOUBLE})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.louquanapp.dao.model.OrderReturn">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 17 14:37:13 CST 2019.
    -->
    update dcdg_bussiness_order_return
    set ORDER_ID = #{orderId,jdbcType=CHAR},
      CHILD_ID = #{childId,jdbcType=CHAR},
      GOODS_ID = #{goodsId,jdbcType=CHAR},
      SELLER_ID = #{sellerId,jdbcType=CHAR},
      SELLER_NAME = #{sellerName,jdbcType=VARCHAR},
      BUYER_ID = #{buyerId,jdbcType=CHAR},
      BUYER_NAME = #{buyerName,jdbcType=VARCHAR},
      REMARK = #{remark,jdbcType=VARCHAR},
      RETURN_CONT = #{returnCont,jdbcType=VARCHAR},
      ADD_TIME = #{addTime,jdbcType=TIMESTAMP},
      REPLY_CONT = #{replyCont,jdbcType=VARCHAR},
      REPLY_TIME = #{replyTime,jdbcType=TIMESTAMP},
      SKU_VAL = #{skuVal,jdbcType=VARCHAR},
      RETURN_STATUS = #{returnStatus,jdbcType=TINYINT},
      GOOD_STATUS = #{goodStatus,jdbcType=TINYINT},
      SERVER_STATUS = #{serverStatus,jdbcType=TINYINT},
      RETURN_IMG = #{returnImg,jdbcType=VARCHAR},
      IS_PROMOTION = #{isPromotion,jdbcType=TINYINT},
      RETURN_MONEY = #{returnMoney,jdbcType=DOUBLE}
    where RETURN_ID = #{returnId,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 17 14:37:13 CST 2019.
    -->
    select RETURN_ID, ORDER_ID, CHILD_ID, GOODS_ID, SELLER_ID, SELLER_NAME, BUYER_ID, 
    BUYER_NAME, REMARK, RETURN_CONT, ADD_TIME, REPLY_CONT, REPLY_TIME, SKU_VAL, RETURN_STATUS, 
    GOOD_STATUS, SERVER_STATUS, RETURN_IMG, IS_PROMOTION, RETURN_MONEY
    from dcdg_bussiness_order_return
    where RETURN_ID = #{returnId,jdbcType=CHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 17 14:37:13 CST 2019.
    -->
    select RETURN_ID, ORDER_ID, CHILD_ID, GOODS_ID, SELLER_ID, SELLER_NAME, BUYER_ID, 
    BUYER_NAME, REMARK, RETURN_CONT, ADD_TIME, REPLY_CONT, REPLY_TIME, SKU_VAL, RETURN_STATUS, 
    GOOD_STATUS, SERVER_STATUS, RETURN_IMG, IS_PROMOTION, RETURN_MONEY
    from dcdg_bussiness_order_return
  </select>

    <select id="childIdOrderStatus" resultType="java.util.Map">
        select CHILD_ID, RETURN_STATUS from  dcdg_bussiness_order_return where BUYER_ID=#{buyerId,jdbcType=CHAR}

    </select>

    <select id="childIds" resultType="String">
        select CHILD_ID
        from dcdg_bussiness_order_return where SELLER_ID = #{sellerId,jdbcType=CHAR} AND CHILD_ID in
        <if test="list != null and list.size()&gt;0">
            <foreach close=")" collection="list" item="id" open="(" separator=",">#{id}
            </foreach>
        </if>
    </select>

    <select id="selectByChildIdAndBuyerId" parameterType="java.lang.String" resultMap="BaseResultMap">
        select RETURN_ID, ORDER_ID, CHILD_ID, GOODS_ID, SELLER_ID, SELLER_NAME, BUYER_ID,
        BUYER_NAME, RETURN_CONT, ADD_TIME, REPLY_CONT, REPLY_TIME, SKU_VAL, RETURN_STATUS,
        GOOD_STATUS, SERVER_STATUS, RETURN_IMG, RETURN_MONEY,REMARK
        from dcdg_bussiness_order_return
        where BUYER_ID = #{buyerId,jdbcType=CHAR} and CHILD_ID = #{childId,jdbcType=CHAR}
    </select>


  <!--退货列表-->
    <select id="afterSaleList" resultMap="ExtraBaseResultMap">
          select   a.RETURN_ID
                  ,a.ORDER_ID
                  ,a.CHILD_ID
                  ,a.GOODS_ID
                  ,a.BUYER_ID
                  ,a.ADD_TIME
                  ,a.RETURN_STATUS
                  ,a.GOOD_STATUS
                  ,a.SERVER_STATUS
                  ,b.PAY_TYPE
                  ,b.ORDER_STATUS
                  ,c.PUTAWAY_PRICE
                  ,c.GOODS_NAME
                  ,c.GOODS_IMG
                  ,c.GOODS_NUM
                  ,c.TOTAL_FEE
                  ,d.SKU_GOODS_NAME
          from    dcdg_bussiness_order_return a
             left join dcdg_bussiness_order_base b on a.ORDER_ID = b.ORDER_ID
             left join dcdg_bussiness_order_item c on a.CHILD_ID = c.CHILD_ID
             left join dcdg_goods_goods_sku      d on c.SKU_NO = d.SKU_ID
          where a. SELLER_ID = #{sellerId,jdbcType=CHAR}  and b.ORDER_STATUS in (601,611,901)
    </select>
  <!--退货详情-->
  <select id="afterSaleDetail" resultMap="ExtraBaseResultMap">
          select    a.RETURN_ID
					,a.ORDER_ID
					,a.CHILD_ID
					,a.GOODS_ID
					,a.BUYER_ID
					,a.ADD_TIME
					,a.RETURN_STATUS
					,a.GOOD_STATUS
					,a.SERVER_STATUS
					,a.RETURN_CONT
					,a.REMARK
					,a.RETURN_IMG
					,a.REPLY_CONT
                    ,a.REPLY_TIME
					,b.PAY_TYPE
					,b.ORDER_STATUS
					,c.PUTAWAY_PRICE
					,c.GOODS_NAME
					,c.GOODS_IMG
					,c.GOODS_NUM
					,c.TOTAL_FEE
					,d.SKU_GOODS_NAME

          from           dcdg_bussiness_order_return a
               left join dcdg_bussiness_order_base b on a.ORDER_ID = b.ORDER_ID
               left join dcdg_bussiness_order_item c on a.CHILD_ID = c.CHILD_ID
               left join dcdg_goods_goods_sku      d on c.SKU_NO = d.SKU_ID
          where a. RETURN_ID = #{returnId,jdbcType=CHAR}  and a. SELLER_ID = #{sellerId,jdbcType=CHAR}
    </select>

    <update id="deniedAfterSale">
      update dcdg_bussiness_order_return set REPLY_CONT = #{replyCont,jdbcType=VARCHAR}
          ,REPLY_TIME = now(),RETURN_STATUS = 4
	  where RETURN_ID = #{returnId,jdbcType=CHAR} and SELLER_ID = #{sellerId,jdbcType=CHAR}
    </update>



  <!--同意退货退款（或仅退款）-->
  <update id="agreeAfterSale">
	update dcdg_bussiness_order_return set RETURN_STATUS = 3
	where RETURN_ID = #{returnId,jdbcType=CHAR}

  </update>



</mapper>